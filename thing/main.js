import*as w from"three";import{OrbitControls as _}from"three/examples/jsm/controls/OrbitControls.js";function W(t,e){return(Math.cos(t*Math.PI)-Math.cos(e*Math.PI))/2}var x=class{steps;step=0;stepProgress=0;lastTime=-1;running=!1;constructor(e){this.steps=e}isRunning(){return this.running}togglePause(){this.running=!this.running,this.running&&(this.lastTime=-1)}stepForward(e){if(this.lastTime===-1){this.lastTime=e;return}let r=this.steps[this.step],s=(e-this.lastTime)/r.t;this.lastTime=e;let l=this.stepProgress,n=this.stepProgress+s;n>=1?(n=1,this.stepProgress=0,++this.step,this.step>=this.steps.length&&(this.step=0)):this.stepProgress=n,r.c(W(l,n))}};import*as a from"three";import{Vector4 as g,Vector3 as C,Color as J,Matrix4 as K}from"three";var Q=[16766208,16777215,18093,39752,11997748,16734208,16761035,8388736].map(t=>new J(t));function X(t){let e=(t&1)*2-1,r=(t&2)*1-1,s=(t&4)*.5-1,l=(t&8)*.25-1;return new g(e,r,s,l)}var I=[];for(let t=0;t<16;++t)I.push(X(t));function Y(t){let e=new Array(8).fill(0);for(let r=0;r<4;++r){let s=(1<<r)-1,l=255^s;for(let n=0;n<2;++n){let u=n<<r,f=(1^r^n)&1;for(let o=0;o<8;++o){let h=(o&l)<<1|o&s|u;e[o^f]=h}t(r<<1|n,e.slice())}}}function Z(t,e){let r=new Array(4).fill(0);for(let s=0;s<3;++s){let l=(1<<s)-1,n=255^l;for(let u=0;u<2;++u){let f=u<<s,o=(1^s^u)&1;for(let h=0;h<4;++h){let R=(h&n)<<1|h&l|f;r[h^o]=R}e(s<<1|u,r.map(h=>t[h]))}}}function V(t,e){return new C(t.x,t.y,t.z).lerp(new C(e.x,e.y,e.z),-t.w/(e.w-t.w))}var A=class{transform;translation;positions;positionAttr;colors;colorAttr;geometry;wireGeometry;ip=0;index=[];wireIndex=[];vertices=[];constructor(){this.transform=new a.Matrix4,this.translation=new g(0,0,0,0);let e=8*12*3;this.positions=new Float32Array(e),this.positionAttr=new a.BufferAttribute(this.positions,3),this.positionAttr.setUsage(a.DynamicDrawUsage),this.colors=new Float32Array(e),this.colorAttr=new a.BufferAttribute(this.colors,3),this.colorAttr.setUsage(a.DynamicDrawUsage),this.geometry=new a.BufferGeometry,this.geometry.setAttribute("position",this.positionAttr),this.geometry.setAttribute("color",this.colorAttr),this.geometry.setIndex([]),this.wireGeometry=new a.BufferGeometry,this.wireGeometry.setAttribute("position",this.positionAttr),this.wireGeometry.setIndex([])}getVertices(){return I.map(e=>e.clone().applyMatrix4(this.transform).add(this.translation))}currentMask(){let e=this.getVertices(),r=0;for(let s of e)r<<=1,s.w>0&&(r|=1);return r}updateFace(e,r){let s=!1,l=!1,n=this.vertices;for(let c of r)n[c].w>0&&(s=!0),n[c].w<0&&(l=!0);if(!s||!l)return;let u=this.ip,f=[];if(Z(r,(c,b)=>{let p=[0,2,3,1,0,2,3,1].map(N=>b[N]),i=0;for(;i<8&&!(n[p[i]].w<0);++i);if(i===8)return;for(;i<8&&!(n[p[i]].w>=0);++i);if(i===8)return;let j={n:p[i-1],p:p[i],v:V(n[p[i-1]],n[p[i]])};for(;i<8&&!(n[p[i]].w>0);++i);if(i===8)return;for(;i<8&&!(n[p[i]].w<0);++i);if(i===8)return;let O={n:p[i],p:p[i-1],v:V(n[p[i]],n[p[i-1]])};f.push({s:j,e:O})}),f.length===0)return;let o=[];for(o.push(f.pop());f.length>0;){let c=o[o.length-1].e,b=f.findIndex(p=>p.s.n===c.n&&p.s.p===c.p);if(b===-1)throw console.log("edges",f),console.log("orderedEdges",o),new Error("Cannot find next edge");o.push(f[b]),f.splice(b,1)}if(!(o[0].s.n===o[o.length-1].e.n&&o[0].s.p===o[o.length-1].e.p))throw console.log("edges",f),console.log("orderedEdges",o),new Error("Edges do not form a loop");let h=this.positions,R=this.colors,q=Q[e];for(let c of o)c.s.v.toArray(h,this.ip*3),q.toArray(R,this.ip*3),++this.ip;let H=this.ip;this.index.push(u,u+1,u+2);for(let c=u+2;c<=H-2;++c)this.index.push(u,c,c+1);for(let c=u;c<H-1;++c)this.wireIndex.push(c,c+1);this.wireIndex.push(H-1,u)}update(){this.vertices=this.getVertices(),this.ip=0,this.index=[],this.wireIndex=[],Y(this.updateFace.bind(this)),this.positionAttr.needsUpdate=!0,this.colorAttr.needsUpdate=!0,this.geometry.setIndex(this.index),this.wireGeometry.setIndex(this.wireIndex)}getObject(){let e=new a.MeshBasicMaterial({vertexColors:!0}),r=new a.Mesh(this.geometry,e),s=new a.LineBasicMaterial({color:0,linewidth:2}),l=new a.LineSegments(this.wireGeometry,s);return r.add(l),r}setStandingTransform(){let e=new g(1,1,1,1).normalize(),r=new g(1,1,-1,-1).normalize(),s=new g(1,-1,1,-1).normalize(),l=new g(-1,1,1,-1).normalize(),n=this.transform.elements;e.toArray(n),r.toArray(n,4),s.toArray(n,8),l.toArray(n,12)}setStandingTranslation(){this.translation.set(0,0,0,-1.5)}shiftUp(e){this.translation.w+=e,this.update()}rotate(e,r){let s=new K;s.elements[e*5]=s.elements[15]=Math.cos(r),s.elements[e*4+3]=Math.sin(r),s.elements[12+e]=-Math.sin(r),this.transform.multiply(s),this.update()}center(){this.setStandingTransform(),this.translation.set(0,0,0,.001),this.update()}xt(){this.setStandingTransform(),this.setStandingTranslation()}};var d=new A;globalThis.fc=d;var B=new w.Scene,D=(window.innerWidth|0)-1,F=(window.innerHeight|0)-1,T=new w.PerspectiveCamera(45,D/F,.1,1e3),v=new w.WebGLRenderer({antialias:!0});v.setSize(D,F);v.setClearColor(4210752);document.body.appendChild(v.domElement);d.center();var G=d.getObject();B.add(G);T.position.set(-9,1.7,2);T.lookAt(G.position);var $=new _(T,v.domElement);$.addEventListener("change",m);var M=new x([{t:4e3,c:t=>{d.shiftUp(t*1.5)}},{t:8e3,c:t=>{d.shiftUp(t*-3)}},{t:4e3,c:t=>{d.shiftUp(t*1.5)}}]),S=!1;function m(){S||requestAnimationFrame(tt),S=!0}function tt(t){S=!1,M.isRunning()&&(M.stepForward(t),m()),et()&&m(),v.render(B,T)}m();var E=new Array(8).fill(!1);function et(){let t=!1;for(let e=0;e<8;++e){if(!E[e])continue;t=!0;let r=e%2?-.02:.02;e<6?d.rotate(e>>1,r):d.shiftUp(r)}return t}function U(t){E[t]||(E[t]=!0,k[t].classList.add("active"),m())}function z(t){!E[t]||(k[t].classList.remove("active"),E[t]=!1)}var L=document.querySelector("#play > i");function rt(){M.togglePause(),L.classList.toggle("fa-play"),L.classList.toggle("fa-pause"),m()}function st(){d.center(),m()}document.getElementById("play").addEventListener("click",st);var P=["q","a","w","s","e","d","r","f"],y=new Map;for(let t=0;t<P.length;++t)y.set(P[t],t);window.addEventListener("keydown",t=>{t.key===" "&&(t.preventDefault(),rt()),y.has(t.key)&&(t.preventDefault(),U(y.get(t.key)))});window.addEventListener("keyup",t=>{y.has(t.key)&&(t.preventDefault(),z(y.get(t.key)))});var k=document.querySelectorAll("#controls i");k.forEach((t,e)=>{t.addEventListener("pointerdown",r=>{r.preventDefault(),U(e)}),t.addEventListener("pointerup",r=>{r.preventDefault(),z(e)})});
//# sourceMappingURL=main.js.map
